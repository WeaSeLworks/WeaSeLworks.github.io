/*SHEEP JS*/
var sheep = [];

(function($, sheep) {
    'use strict';
    var numOfSheep = 23;
    var lastScrollTop = 0;
    var notificationHeight = 40;
    var sheepSectionOffset; 
    var notificationOffset;
    var highlightOffset;
    var notification;
    var notifiying = false;
    let svg = d3.select("svg#field-of-sheep");
    
    $(window).on('scroll', function() {
        let scrollTop = $(this).scrollTop();
        
        var downwards = scrollTop > lastScrollTop;
        var direction = downwards ? 1 : -1;
        animateSheep(scrollTop);
        animateDog(scrollTop);
        animateAppNotification(scrollTop, direction);

        lastScrollTop = scrollTop;
    });

    function init() {
        for (var i=0; i< numOfSheep; i++) {
            sheep.push(generateSheepInfo(i));
        }
    }
    
    function animateDog(scrollTop) {
        let dog = svg.selectAll("g.dog")
            .data([{
                x : 620 ,
                y : 250
            }])
            .attr('transform', (dog) => {
                let x = dog.x - ((scrollTop - sheepSectionOffset)/3);
                return `translate(${x}, ${dog.y}) scale(-0.143, 0.143) translate(-489.5,0)`
            });

        let dogPath = dog.enter().append("g")
            .classed('dog', true);
            

        dogPath.append('g')
            .append('path')
            .attr('d', "M489.092,95.424c-0.74-2.151-2.417-3.85-4.558-4.619L448.166,77.75l-6.111-10.864c-2.028-3.603-5.511-6.153-9.558-6.996 l-34.898-7.271c-9.146-1.905-18.379,1.902-23.524,9.7l-50.962,77.239c-3.597,5.452-9.366,9.164-15.827,10.183 c-24.598,3.88-72.476,10.233-116.691,9.187c-21.268-0.502-41.948,2.683-61.497,9.47c-6.079,2.111-11.773,4.468-17.078,7.058 c-9.855-0.573-67.852-2.281-76.578,35.894c-8.14,35.615,17.475,71.732,21.829,77.538c-0.011,0.381-0.022,0.771-0.032,1.143 c-0.616,22-0.71,25.381-16.031,34.362C11.697,341.694,4.18,351.421,3.42,352.474c-0.882,1.221-1.376,2.68-1.417,4.186l-2,73 c-0.056,2.024,0.709,3.984,2.122,5.436s3.351,2.27,5.375,2.27H39c2.411,0,4.675-1.159,6.084-3.115s1.793-4.47,1.03-6.757 l-0.775-2.324c-2.147-6.441-6.809-11.663-12.761-14.586c0.664-15.354,5.243-44.048,21.675-51.96 c7.675-3.695,17.572-8.921,27.917-15.587c1.612,7.482,1.91,14.457,0.853,20.794c-0.681,4.086,2.079,7.95,6.165,8.631 c0.417,0.069,0.833,0.103,1.242,0.103c3.6,0,6.778-2.6,7.389-6.268c1.66-9.958,0.821-20.86-2.485-32.433 c2.167-1.638,4.322-3.336,6.448-5.095c18.831-15.59,31.075-32.315,36.39-49.711c1.408-4.609,5.204-15.606,5.874-16.885 c3.133-5.982,8.345-10.634,14.774-13.064c6.921-2.615,14.743-2.336,21.46,0.763l73.956,34.133 c18.53,8.552,38.918,13.173,59.333,13.511c9.35,43.911,4.703,77.19,2.468,88.704c-1.127,5.803-0.301,11.892,2.326,17.145 l13.928,27.855c1.271,2.541,3.867,4.146,6.708,4.146h30c2.686,0,5.166-1.436,6.503-3.765c1.338-2.329,1.328-5.195-0.025-7.515 l-2.938-5.036c-2.85-4.886-7.39-8.583-12.654-10.451l-4.318-13.672l6.092-102.703c0.394-6.637,2.44-12.989,5.917-18.368 c7.632-11.808,16.589-32.349,15.92-63.154c-0.791-36.403,23.373-77.516,30.991-89.542l40.421,2.343 c11.75,0.684,22.978-5.083,29.27-15.044l4.161-6.588C489.556,99.946,489.832,97.576,489.092,95.424z M50.064,214.694 c3.479-15.22,21.59-21.04,37.362-23.183c-14.367,12.587-23.144,28.16-25.844,46.246c-1.379,9.242-2.288,17.371-2.908,24.577 C52.289,249.496,46.199,231.603,50.064,214.694z M455.778,108.528l-44.758-2.595c-4.017-0.233-7.791-2.146-10.354-5.249 l-7.504-9.084c-2.639-3.193-7.365-3.644-10.559-1.005c-3.193,2.638-3.644,7.366-1.005,10.559l7.504,9.083 c2.68,3.245,6.015,5.843,9.73,7.672c-10.319,17.088-31.132,56.265-30.33,93.118c0.617,28.425-8.207,46.463-13.521,54.686 c-4.878,7.548-7.746,16.408-8.293,25.622l-6.174,104.085c-0.054,0.914,0.059,1.83,0.335,2.703l6,19 c0.4,1.267,1.117,2.375,2.053,3.242h-5.266l-11.855-23.709c-1.156-2.312-1.517-5.003-1.017-7.578 c4.214-21.712,10.615-79.914-20.903-151.244c-1.674-3.789-6.103-5.5-9.892-3.829c-3.789,1.674-5.503,6.103-3.829,9.892 c5.901,13.355,10.377,26.254,13.742,38.496c-17.012-0.792-33.906-4.876-49.36-12.007l-73.956-34.133 c-10.345-4.775-22.39-5.203-33.049-1.175c0,0-0.001,0-0.001,0c2.629-6.518,4.225-9.926,4.263-10.004 c1.771-3.743,0.173-8.212-3.569-9.985c-3.743-1.774-8.215-0.176-9.988,3.567c-0.377,0.796-9.361,19.91-20.395,56.019 c-3.641,11.917-18.343,42.635-76.081,70.435c-30.983,14.917-30.29,68.625-30.245,70.904c0.053,2.687,1.526,5.069,3.755,6.353h-6.048 l1.713-62.521c3.102-3.085,11.849-10.771,31.872-22.508c22.496-13.188,22.792-23.747,23.439-46.883 c0.326-11.652,0.772-27.611,4.186-50.48c3.907-26.175,23.286-45.488,57.6-57.402c17.848-6.196,36.761-9.105,56.222-8.644 c45.406,1.076,94.287-5.407,119.384-9.366c10.616-1.675,20.096-7.776,26.01-16.739l50.962-77.239 c1.622-2.459,4.451-3.721,7.333-3.356l-1.43,1.544c-2.815,3.039-2.633,7.784,0.405,10.599c1.443,1.337,3.271,1.998,5.095,1.998 c2.016,0,4.026-0.808,5.504-2.403l7.601-8.206l18.031,3.757l2.07,3.679c-2.942,1.326-4.798,4.463-4.35,7.826 c0.502,3.77,3.723,6.51,7.425,6.51c0.33,0,0.664-0.022,1-0.067l6.903-0.92l28.415,10.2 C467.111,106.29,461.563,108.863,455.778,108.528z")
            .attr('fill', '#777');
            
       let barkColor = '#9d9d9d';
       let barkWidth = 10;
            
        dogPath.append('path')
            .attr('d', "M 540,60 l 90 -20")
            .attr('stroke', barkColor)
            .attr('stroke-width', barkWidth);

        dogPath.append('g')
            .append('path')
            .attr('d', "M 540,100 l 100 0")
            .attr('stroke', barkColor)
            .attr('stroke-width', barkWidth);

        dogPath.append('path')
            .attr('d', "M 540,140 l 90 20")
            .attr('stroke', barkColor)
            .attr('stroke-width', barkWidth);
    }
    
    function animateAppNotification(scrollTop, direction) {
        if (scrollTop > notificationOffset && !notifiying) {
            notifiying = true;
            notification.animate({
                height: '33px',
                width: '165px'
            }, 700, "swing");
        }

        //reset the animation if user scrolled upwards past where it began
        if (scrollTop < notificationOffset && notifiying && direction < 0) {
            notifiying = false;
            notification.css({
                height: '0',
                width: '0'
            });
        }
    }
    
    function generateSheepInfo(index) {
        var horizontalVariance = 100;
        var ahead = Math.floor(Math.random() * 4) > 2;
        var lag = ahead ? 1 : -1;
        var randomOffset = lag * Math.floor(Math.random() * horizontalVariance);
        var origin = 400;
        
        return {
            index: index,
            x: origin + randomOffset,
            y: index * 20,
            healthy : true,
            width: 50
        }
    }
    
    function animateSheep(scrollTop) {
        let allSheep = svg.selectAll("g.sheepG")
            .data(sheep)
            .attr('transform', (sheep) => {
                let x = sheep.x - ((scrollTop - sheepSectionOffset)/3);
                return `translate(${x}, ${sheep.y}) scale(0.1, 0.1)`
            });
       
        let sheepPath = allSheep.enter().append("g")
            .classed('sheepG', true)
            .attr('transform', (sheep) => {
                return `scale(0.1, 0.1)`
            });

        sheepPath.append('g') 
            .append('path')
            .attr('d', "M460.216,149.194l-64-40c-1.271-0.795-2.741-1.216-4.24-1.216H179.288l-37.656-37.656c-1.094-1.097-2.484-1.853-4-2.176    l-3.84-0.8h-0.072l-36.16-7.2c-1.345-0.261-2.735-0.178-4.04,0.24l-48.056,16c-1.762,0.59-3.264,1.775-4.248,3.352l-40,64    c-1.974,3.159-1.506,7.262,1.128,9.896l15.976,16c2.141,2.143,5.31,2.892,8.184,1.936l41.424-13.808l68.888,137.792    c0.389,0.768,0.897,1.47,1.504,2.08l37.656,37.656v60.688c0,4.418,3.582,8,8,8h24c4.418,0,8-3.582,8-8V327.29l10.832-10.824    l52,7.432c1.149,0.165,2.32,0.077,3.432-0.256l76.4-22.92l20.304,13.504l37,29.6v52.152c0,4.418,3.582,8,8,8h24    c4.418,0,8-3.582,8-8v-64c0.014-1.238-0.26-2.462-0.8-3.576l-5.928-11.848l13.424-20.136c0.871-1.317,1.336-2.861,1.336-4.44v-136    C463.976,153.22,462.555,150.656,460.216,149.194z M123.976,81.722v22.944l-11.664,11.656l-9.704-38.864L123.976,81.722z     M447.976,289.578l-14.656,21.984c-1.588,2.384-1.78,5.435-0.504,8l7.2,14.312v54.104h-8v-48c0.001-2.43-1.103-4.729-3-6.248    l-40.56-32.408l-24-16c-1.98-1.33-4.453-1.7-6.736-1.008L279.4,307.81l-54.248-7.752c-2.494-0.357-5.011,0.482-6.792,2.264l-16,16    c-1.515,1.493-2.373,3.529-2.384,5.656v64h-8v-56c0-2.122-0.844-4.156-2.344-5.656l-39.08-39.08l-71.376-142.84    c-1.785-3.558-5.913-5.262-9.688-4l-43.352,14.424l-8-8L53.239,90.65l33.376-11.128l13.6,54.4c0.692,2.792,2.831,4.998,5.6,5.776    c0.704,0.19,1.431,0.284,2.16,0.28c2.122,0,4.156-0.844,5.656-2.344l24-24c1.5-1.5,2.344-3.534,2.344-5.656V91.29l30.344,30.344    c1.5,1.5,3.534,2.344,5.656,2.344H389.68l58.296,36.432V289.578z")
            .attr('fill', '#777');

        sheepPath.append('g')
            .append('path')
            .attr('d', "M411.976,211.978v-8h-8c-8.837,0-16-7.163-16-16v-8h-16v8c0.027,14.902,10.337,27.813,24.864,31.136    c3.323,14.527,16.234,24.837,31.136,24.864v-16C419.139,227.978,411.976,220.815,411.976,211.978z")
            .attr('fill', '#777');
    }

    init();
    
    

    $(document).ready(function() {
        var windowHeight = $(window).height();
        sheepSectionOffset = $('div#sheep-container').offset().top - windowHeight;
        notificationOffset = $('div#worrying-alert').offset().top - windowHeight + 500;
        highlightOffset = notificationOffset + notificationHeight;
        notification = $('svg#shadow').find('g#notification').find('image');
    });
    
})(jQuery, sheep);




